<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>reservoir List</title>
</head>

<body onload="call_api()">
    <div class="input_con" style="display: inline-flex; height: fit-content;">
        <p style="font-size: 20px;">reservior threshold : </p>
        <input name="threshold" id="input_field" value="90">
        <p style="font-size: 20px;" >&nbsp % &nbsp</p>
        <button onclick="call_api()">Refesh</button>
    </div>
    <div class="content" style="font-size: 20px; color: blueviolet; margin-top: 10px;">
        click reservoir to open google map
    </div>



    <script>

        
        const dd = document.createElement("div")
        const myInput = document.getElementById("input_field")
        // myInput.addEventListener('input', (event) => {
        //     dd.innerHTML = ""
        //     const thres = parseFloat(event.target.value)
        //     call_api(thres)

        // })
        async function call_api(th) {
            dd.innerHTML = ""
            
            const thw = parseFloat(myInput.value)
            const res = await fetch("https://app.rid.go.th/reservoir/api/reservoir/public")
            try {
                if (res.status == 200 && res.ok) {
                    const data = await res.json()
                    const sub = data.data
                    
                    
                    for (let key in sub) {
                        const re = sub[key]
                        //console.log(re.region)
                        const c = document.createElement("h1")
                        dd.appendChild(c)
                        c.innerText = re.region
                        const x = document.createElement("ul")
                        dd.appendChild(x)

                        for (let k in re) {
                            const rf = re[k]
                            //console.log(rf)

                            for (let i in rf) {
                                //console.log(rf[i])
                                if (rf[i].name ) {
                                    const y = document.createElement("li");
                                    const l = document.createElement("a");
                                    l.href = "https://www.google.com/maps/search/?api=1&query="+ rf[i].name;
                                    l.target = "_blank"
                                    l.innerHTML  = "เปอร์เซ็นน้ำตอนนี้ = " + rf[i].percent_storage + "% &nbsp&nbsp&nbsp|&nbsp&nbsp" + rf[i].name;
                                    l.style.fontSize = "20px";
                                    l.style.textDecoration = "none"
                                    console.log(th)
                                    console.log(thw)
                                    if (await rf[i].percent_storage > (th ?? thw)) {
                                        l.style.color = "red"
                                    } else {
                                        l.style.color = "black"
                                    }
                                    await y.appendChild(l)
                                    await x.appendChild(y)
                                }
                            }
                            
                        }

                    }
                    document.body.appendChild(dd)

                    //console.log(sub)
                }
            } catch (error) {
                console.log(error)
            }
        }
    </script>
</body>

</html>